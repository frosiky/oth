<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>test</title>
    <style>
      table {
        background-color: #ffe;
        border-collapse: collapse;
      }

      table td {
        border: solid 3px #aaa;
        padding: 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <table id="tb1"></table>
    <h3 id="score"></h3>
    <h3 id="status"></h3>
    <script type="module">
      import othello from "./lib/othello.js";
      const oth = new othello();
      const table = document.getElementById("tb1");
      for (let i = 0; i < 8; i++) {
        const row = table.insertRow(-1);
        for (let j = 0; j < 8; j++) {
          const cell = row.insertCell(-1);
          cell.id = i + "-" + j;
          cell.onclick = clicked;
        }
      }
      update();

      function clicked(e) {
        const flipCells = oth.putIf(e.target.id[0] / 1, e.target.id[2] / 1);
        if (flipCells.length) {
          for (const pos of flipCells) {
            oth.put(pos[0], pos[1]);
          }
          oth.goForward();
        }
        update();
      }
      function update() {
        const preview = oth.canput();
        const score = [0, 0];
        for (let i = 0; i < 8; i++) {
          for (let j = 0; j < 8; j++) {
            const cell = document.getElementById(i + "-" + j);
            var core = "　";
            if (oth.data[i][j] == 1) {
              core = "⚪";
              score[0]++;
            } else if (oth.data[i][j] == -1) {
              core = "⚫";
              score[1]++;
            } else {
              if (preview.includes([i, j])) {
                core = "・";
              } else {
                core = "nai"
              }
            }
            cell.innerHTML = core;
          } 
        }
        const scoreDisplay = document.getElementById("score");
        const statusDisplay = document.getElementBtId("status");
        scoreDisplay.content =preview.toString()
        if (oth.canput().length) {
          oth.goForward();
          statusDisplay.content = (oth.turn == 1 ? "⚫" : "⚪") + ":パスしました\n" + (oth.turn == 1 ? "⚪" : "⚫") + "の手番です";
        } else {
          statusDisplay.content =  (oth.turn == 1 ? "⚪" : "⚫") + "の手番です";
        }    
      }
    </script>
  </body>
</html>
