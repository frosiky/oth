<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"></meta>
    <meta property="og:title" content="Othello">
    <meta property="og:description" content="for 2 player in one display">
    <meta property="og:image" content="https://d.kuku.lu/mkypb2mf8">
    <title>Othello board</title>
    <style>
      table {
        background-color: #ffe;
        border-collapse: collapse;
      }

      table td {
        border: solid 3px #aaa;
        padding: 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h3 id="score">loading</h3>
    <table id="tb1"></table>
    <h3 id="status"></h3>
    <h3 id="pass"></h3>
    <script type="module">
      import othello from "./lib/othello.js";
      const oth = new othello();
      const table = document.getElementById("tb1");
      for (let i = 0; i < 8; i++) {
        const row = table.insertRow(-1);
        for (let j = 0; j < 8; j++) {
          const cell = row.insertCell(-1);
          cell.id = i + "-" + j;
          cell.onclick = clicked;
        }
      }
      update();
      
      function clicked(e) {
        const flipCells = oth.putIf(e.target.id[0] / 1, e.target.id[2] / 1);
        if (flipCells.length) {
          for (const pos of flipCells) {
            oth.put(pos[0], pos[1]);
          }
          oth.goForward();
        }
        update();
      }
      function update() {
        let preview = oth.canput();
        const statusDisplay = document.getElementById("status");
        const scoreDisplay = document.getElementById("score");
        const pass = document.getElementById("pass")
        if (!preview.length) {
          oth.goForward();
          preview = oth.canput()
          if (!preview.length) {
            const score_end = oth.end.result.score;
            scoreDisplay.textContent = `⚫:${score_end[0]}  ⚪:${+score_end[1]}`;
            statusDisplay.textContent = "ゲームセット-設置可能なマスは無くなりました";
            pass.innerHTML = "<strong>"
              +oth.end.result == 0 
                ? "引き分け" 
                : (oth.end.result.winP == 1 
                  ? "⚫"
                  :"⚪")+"の勝ち"
              +"</strong>です";
              for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                  const cell = document.getElementById(i + "-" + j);
                  var core = "　";
                  if (oth.data[i][j] == 1) {
                    core = "⚫";
                  } else if (oth.data[i][j] == -1) {
                    core = "⚪";
                  }
                  cell.textContent = core;
                  cell.onclick = "return";
                }
              }    
              return;
          }
          statusDisplay.textContent = "手番:" + (oth.turn == 1 ? "⚫" : "⚪");
          pass.textContent = (oth.turn == 1 ? "⚪" : "⚫") + ":パス";
        } else {
          statusDisplay.textContent = "手番:" + (oth.turn == 1 ? "⚫" : "⚪");
          pass.textContent = "";
        }
        const score = [0, 0];
        for (let i = 0; i < 8; i++) {
          for (let j = 0; j < 8; j++) {
            const cell = document.getElementById(i + "-" + j);
            var core = "　";
            if (oth.data[i][j] == 1) {
              core = "⚫";
              score[0]++;
            } else if (oth.data[i][j] == -1) {
              core = "⚪";
              score[1]++;
            } else {
              if (preview.map(e => e.join("-")).includes(i + "-" + j)) {
                core = "・"
              } else {
                core = "　";
              }
            }
            cell.textContent = core;
          } 
        }
        scoreDisplay.textContent = "⚫:"+score[0]+"⚪:"+score[1];
      }
    </script>
  </body>
</html>
